$(document).ready((function(){$("[data-bs-chart]").each((function(e,t){this.chart=new Chart($(t),$(t).data("bs-chart"))}))})),Dropzone.autoDiscover=!1;var uploadedFiles=[];function onFillDummyData(){$.each(Config.dummyData,(function(e,t){$("#"+e).val(t).trigger("change")})),$("#submit_request_form select").trigger("chosen:updated"),swal({title:"Success",text:"Test data has been populated",type:"success",showConfirmButton:!1,timer:1e3})}function loadSelectControl(e,t){executeRule("root_DICT_getWords",{CategoryPath:t,sort:"NAME",dir:"ASC"},(function(n){"DOCUMENT_CATEGORIES"==t?updateRecordCategory(e,n):updateSelectControl(e,n)}))}function updateSelectControl(e,t){var n=["<option></option>"],o=$(e);$(t.ITEMS).each((function(e,t){if(!t.ISDELETED){var o=$("<option></option>").attr("value",t.ID).text(t.NAME);o.data(t),n.push(o)}})),o.html(n);var i=getControlId().indexOf(e);$(e+"_chosen input").attr("tabindex",100+i)}function updateRecordCategory(e,t){var n=["<option></option>"],o=$(e);$(t.ITEMS).each((function(e,t){if(!t.ISDELETED){var o=$("<option></option>").attr("value",t.CODE).text(t.NAME);o.data(t),n.push(o)}})),o.html(n),$(e).chosen({inherit_select_classes:!0,placeholder_text_single:" "});var i=getControlId().indexOf(e);console.log(e),$(e+"_chosen input").attr("tabindex",100+i)}function getControlId(){return["#dummyDataButton","#createNewCase","#submitNewChargeBtn","#txtSummary","#txtDescription","#txtCDM_RECORDS_REQSTER_FIRST_NAME","#txtCDM_RECORDS_REQSTER_LAST_NAME","#txtAccountEmail","#txtCDM_RECORDS_REQREQUESTER_PHONE","#selCASE_INITIATION_CHANNEL_ID","#selPROVINCES_ID","#selCDM_RECORDS_REQRECORD_CATEGORY","txtRECORDS_REQST_REQUEST_TYPE","txtRECORDS_REQUESTED_DOCUMENT"]}function setTabIndex(){getControlId().forEach((function(e,t){var n=$(e);"select"===n.prop("tagName").toLowerCase()&&(n=$(e+"_chosen input")),n.attr("tabindex",100+t)}))}function fixFileName(e){if(e&&(e=e.replace(/ /g,"_")).length>100){var t,n;t=e.substring(0,e.lastIndexOf(".")).substring(0,100),n=e.substring(e.lastIndexOf(".")+1,e.length),e=t+"."+n}return e}function fileUploaded(e){uploadedFiles.push(e)}function executeRule(e,t,n,o){var i=String.format("{0}BDS.WebService/DataServiceRest.svc/post/{1}/{2}",Config.siteUrl,Config.appBaseDomain,e),a=getCookieByName(Config.getCookieTokenName()),r=$("#txtAccountEmail").val();a?(i+="?t="+a,n=n||function(){},o=o||function(){},$.ajax({url:i,type:"POST",data:t,success:function(t){if(!t||500!==t.ErrorCode){var i=t.DATA[e],a="",s="";if(i){if(s=i.ERRORMESSAGE)return swal({title:"Error Executing Rule",text:s+" - Please contact your administrator",type:"warning"}),void o(i,s);a=i.CASE_ID,n(i,a),a&&(swal({title:"Information",text:"Successfully Created Case ID "+a,showConfirmButton:!0}),executeRule("ROOT_CUST_PRTL_ADDCP",{CaseId:a,EPemail:r}))}}},error:function(t,n){swal({title:"Error Executing Rule",text:e+" - Please contact your administrator",type:"error"}),o()}})):setTokenExpires()}function validateNewCaseForm(){var e=[];return $("#submit_request_form .required").find("input:not(.chosen-search-input), select").each((function(t,n){var o=$(n);if(!$.trim(o.val())){var i=o.prev("label").text();e.push(i+" is required")}})),e.length>0?(swal({title:"Form is invalid",text:e.join("\n"),type:"warning"}),!1):!($("#submit_request_form .has-error").length>0)||(swal({title:"Invalid form",text:"The Charge Code is not acceptable by District Court",type:"warning"}),!1)}function onSubmitNewCase(){var e=$("#submit_request_form"),t=e.serializeArray();$(".date-picker input",e).each((function(e,n){var o=(n=$(n)).datepicker("getDate"),i=$.datepicker.formatDate("dd-M-yy",o),a=n.attr("name");$.each(t,(function(e,t){if(t.name===a)return t.value=i,!1}))}));var n="";if(uploadedFiles.length>0){var o=[],i=[];uploadedFiles.forEach((function(e){o.push(e.file.url),i.push(e.file.originalFileName)})),n+="<DOCUMENTSURLS><![CDATA["+o.join("|||")+"]]></DOCUMENTSURLS><DOCUMENTSNAMES><![CDATA["+i.join("|||")+"]]></DOCUMENTSNAMES>"}var a='<CustomData><Attributes>\t<Object ObjectCode="CASE"><Item>\t<ID>-3</ID><PARENTID>0</PARENTID><ParentCode></ParentCode><OBJECTCODE><![CDATA[CASE]]></OBJECTCODE>\t<CASESYSTYPE_ID>{1}</CASESYSTYPE_ID>\t<SUMMARY><![CDATA[{2}]]></SUMMARY>\t<DESCRIPTION><![CDATA[{3}]]></DESCRIPTION>\t<PRIORITY_ID>{0}</PRIORITY_ID>\t<CASESYSTYPE_CODE></CASESYSTYPE_CODE><WORKBASKET_ID>0</WORKBASKET_ID><DRAFT>0</DRAFT><ASSIGNORNAME></ASSIGNORNAME>\t<ASSIGNEENAME></ASSIGNEENAME><CASEFROM></CASEFROM><DESIGNERPAGE_ID>0</DESIGNERPAGE_ID><RESOLUTIONCODE_ID>0</RESOLUTIONCODE_ID>\t<HOURSSPENT>0</HOURSSPENT><INTEGTARGET_ID>0</INTEGTARGET_ID><MANUALDATERESOLVED></MANUALDATERESOLVED><WORKITEM_ID>0</WORKITEM_ID>\t<WORKITEM_WORKFLOW></WORKITEM_WORKFLOW><PERM_CASETYPE_DETAIL>0</PERM_CASETYPE_DETAIL><COL_ID>0</COL_ID>'+n+'</Item></Object><Object ObjectCode="CDM_RECORDS_REQUEST"><Item>   <CASETYPEID>21</CASETYPEID><OBJECTCODE><![CDATA[CDM_RECORDS_REQUEST]]></OBJECTCODE>1   <PARENTID>-3</PARENTID><ID>-2</ID><ParentCode></ParentCode>   {4}   </Item></Object></Attributes></CustomData>',r="";$.each(t,(function(e,t){r+="\t\t<"+t.name+">"+t.value+"</"+t.name+">\n"}));var s=$("#txtSummary").val(),l=$("#txtDescription").val();return a=String.format(a,Config.casePriorityId,Config.caseTypeId,s,l,r),swal({title:"Processing",text:"Briefing submission...",showConfirmButton:!1,type:"warning",timer:1500}),executeRule(Config.caseCreateRule,{InputXML:a},(function(e){"0"===e.ERRORCODE&&(swal({title:"Success",text:"Case has been submitted",type:"success",showConfirmButton:!0}),loadUserCases())})),!1}function onNewPaymentRequest(){var e=$("#submit_request_form"),t=e.serializeArray();$(".date-picker input",e).each((function(e,n){var o=(n=$(n)).datepicker("getDate"),i=$.datepicker.formatDate("dd-M-yy",o),a=n.attr("name");$.each(t,(function(e,t){if(t.name===a)return t.value=i,!1}))}));var n="";if(uploadedFiles.length>0){var o=[],i=[];uploadedFiles.forEach((function(e){o.push(e.file.url),i.push(e.file.originalFileName)})),n+="<DOCUMENTSURLS><![CDATA["+o.join("|||")+"]]></DOCUMENTSURLS><DOCUMENTSNAMES><![CDATA["+i.join("|||")+"]]></DOCUMENTSNAMES>"}var a='<CustomData><Attributes>\t<Object ObjectCode="CASE"><Item>    <ID>-3</ID><PARENTID>0</PARENTID><PARENTCODE></PARENTCODE><OBJECTCODE><![CDATA[CASE]]></OBJECTCODE>    <PRIORITY_ID>{0}</PRIORITY_ID>\t<CASESYSTYPE_ID>{1}</CASESYSTYPE_ID>\t<SUMMARY><![CDATA[{2}]]></SUMMARY>    <DESCRIPTION><![CDATA[{3}]]></DESCRIPTION>    <DRAFT>0</DRAFT>';a+=n,a+="<OWNER_WORKBASKET_ID>{4}</OWNER_WORKBASKET_ID>",a+="</Item></Object>",a+='<Object ObjectCode="CDM_PAYMENT_REQUEST"><Item>    <CASETYPEID>41</CASETYPEID><OBJECTCODE><![CDATA[CDM_GENERAL_INQUIRY]]></OBJECTCODE>    <DOMOBJECTCODE><![CDATA[CDM_PAYMENT_REQUEST]]></DOMOBJECTCODE>    <PARENTID>-3</PARENTID><ID>-2</ID><PARENTCODE></PARENTCODE><MODELID>61</MODELID>    {5}    </Item></Object></Attributes></CustomData>';var r="";$.each(t,(function(e,t){r+="\t\t<"+t.name+">"+t.value+"</"+t.name+">\n"}));var s=$("#txtPayReqDesc").val();return a=String.format(a,"4","21","Payment Request sent from Portal",s,"62",r),swal({title:"Processing",text:"Briefing submission...",showConfirmButton:!1,type:"warning",timer:500}),executeRule(Config.caseCreateRule,{InputXML:a},(function(e){"0"===e.ERRORCODE&&(swal({title:"Success",text:"Case has been submitted",type:"success",showConfirmButton:!0}),loadUserCases())})),!1}function onNewGeneralInquiry(){var e=$("#submit_inquiry_form").serializeArray(),t="";if(uploadedFiles.length>0){var n=[],o=[];uploadedFiles.forEach((function(e){n.push(e.file.url),o.push(e.file.originalFileName)})),t+="<DOCUMENTSURLS><![CDATA["+n.join("|||")+"]]></DOCUMENTSURLS><DOCUMENTSNAMES><![CDATA["+o.join("|||")+"]]></DOCUMENTSNAMES>"}var i='<CustomData><Attributes>\t<Object ObjectCode="CASE"><Item>    <ID>-3</ID><PARENTID>0</PARENTID><ParentCode></ParentCode><OBJECTCODE><![CDATA[CASE]]></OBJECTCODE>    <PRIORITY_ID>{0}</PRIORITY_ID>\t<CASESYSTYPE_ID>{1}</CASESYSTYPE_ID>\t<SUMMARY><![CDATA[{2}]]></SUMMARY>    <DESCRIPTION><![CDATA[{3}]]></DESCRIPTION>    <DRAFT>0</DRAFT>';i+=t,i+="<OWNER_WORKBASKET_ID>{4}</OWNER_WORKBASKET_ID>",i+="</Item></Object>",i+='<Object ObjectCode="CDM_GENERAL_INQUIRY"><Item>    <CASETYPEID>{1}</CASETYPEID><OBJECTCODE><![CDATA[CDM_GENERAL_INQUIRY]]></OBJECTCODE>    <DOMOBJECTCODE><![CDATA[CDM_GENERAL_INQUIRY]]></DOMOBJECTCODE>    <PARENTID>-3</PARENTID><ID>-2</ID><PARENTCODE></PARENTCODE><MODELID>61</MODELID>    {5}    </Item></Object></Attributes></CustomData>';var a="";$.each(e,(function(e,t){a+="\t\t<"+t.name+">"+t.value+"</"+t.name+">\n"}));var r=$("#txtGenIqDesc").val();return i=String.format(i,"4","41","General Inquiry sent from Portal",r,"101",a),swal({title:"Processing",text:"Briefing submission...",showConfirmButton:!1,type:"warning",timer:500}),executeRule(Config.caseCreateRule,{InputXML:i},(function(e){"0"===e.ERRORCODE&&(swal({title:"Success",text:"Case has been submitted",type:"success",showConfirmButton:!0}),loadUserCases())})),!1}$((function(){if(getCookieByName(Config.getCookieTokenName())){$.each({selARIMR_UNIT_ID1:"UNITS",selARIMR_UNIT_ID2:"UNITS",selACTION_ID:"ACTIONS",selPURPOSE_ID:"PURPOSE",selDOCUMENT_TYPE_ID:"DOCTYPES",selPREFERRED_CONTACT_METHOD_ID:"PREFERRED_CHANNELS"},(function(e,t){loadSelectControl("#"+e,t)})),$(".bool-chosen").chosen({disable_search_threshold:3,inherit_select_classes:!0,placeholder_text_single:" "}),Config.showDummyDataButton&&$("#dummyDataButton").show(),$('input[type="date"]').change((function(){var e=$.datepicker.formatDate("yy-mm-dd",new Date);$(this).val()<e&&($(this).val(e),swal({title:"Validation Failed",text:"Date cannot be in the past.",type:"warning"}))}));$(".date-picker input").datepicker({changeMonth:!0,changeYear:!0,yearRange:"1900:"}).change((function(){$(this).datepicker("setDate",$(this).datepicker("getDate"))}));var e={previewTemplate:$("#preview-template").html(),parallelUploads:2,thumbnailHeight:120,thumbnailWidth:120,maxFilesize:3,filesizeBase:1e3,thumbnail:function(e,t){if(e.previewElement){e.previewElement.classList.remove("dz-file-preview");for(var n=e.previewElement.querySelectorAll("[data-dz-thumbnail]"),o=0;o<n.length;o++){var i=n[o];i.alt=e.name,i.src=t}setTimeout((function(){e.previewElement.classList.add("dz-image-preview")}),1)}}};!1===Config.fakeUpload&&(e.method="POST",e.url=function(e){var t=fixFileName(e[0].name),n=(Config.cmsRootPath?Config.cmsRootPath+"/":"")+Config.getFileNameToUpload(t),o=getCookieByName(Config.getCookieTokenName());return Config.getCMSServiceRestUrl("putResource/"+Config.getRuntimeDomain())+"?t="+o+"&u=/"+n},e.renameFilename=function(e){return fixFileName(e)});var t=new Dropzone("#demo-upload",e);if(!1!==Config.fakeUpload){var n=6,o=60,i=100,a=1e5;t.uploadFiles=function(e){for(var t=this,r=0;r<e.length;r++)for(var s=e[r],l=Math.round(Math.min(o,Math.max(n,s.size/a))),u=0;u<l;u++){var c=i*(u+1);setTimeout(function(e,n,o){return function(){e.upload={progress:100*(o+1)/n,total:e.size,bytesSent:(o+1)*e.size/n},t.emit("uploadprogress",e,e.upload.progress,e.upload.bytesSent),100==e.upload.progress&&(e.status=Dropzone.SUCCESS,t.emit("success",e,"success",null),t.emit("complete",e),t.processQueue())}}(s,l,u),c)}}}else t.on("sending",(function(e,t,n){t.setRequestHeader("OriginalFileName",fixFileName(e.name)),t.setRequestHeader("ContentType",e.type),t.setRequestHeader("ContentLength",e.size),Config.CSRFToken&&t.setRequestHeader("CSRFToken",Config.CSRFToken)})),t.on("error",(function(e){swal({title:"Error",text:"Upload failed",type:"error",showConfirmButton:!0}),console.error(e)})),t.on("success",(function(e){var t=JSON.parse(e.xhr.response);if(t&&t.Url){var n=JSON.parse(e.xhr.response).Url,o=Config.getFileNameUploaded(n),i=this.files.filter((function(e){return"error"!==e.status})),a=i.length-1,r=i.findIndex((function(t){return t==e}));fileUploaded({file:{url:n,name:o,contentLength:e.size||"",contentType:e.type||"",originalFileName:e.name||""},isLastDocument:r===a?1:0})}})),t.on("queuecomplete",(function(){var e=this,t=e.files,n=(e.options,[]);if("number"==typeof e.options.maxFiles&&e.files.length>e.options.maxFiles){swal({title:"Warning",text:"Maximum number of files is "+e.options.maxFiles+". All other files will be deleted",type:"success",showConfirmButton:!0});for(var o=e.files.length,i=e.options.maxFiles;i<o;i++)e.removeFile(t[i]);t.splice(e.files.length,o-e.options.maxFiles)}for(i=0;i<t.length;i++){var a=t[i];if("success"===a.status&&!a.added){var r=JSON.parse(a.xhr.response).Url,s=Config.getFileNameUploaded(r);n.push({url:r,name:s,contentLength:a.size||"",contentType:a.type||"",originalFileName:a.name||""}),a.added=!0}}}));var r=new Dropzone("#uploadGI",e);if(!1!==Config.fakeUpload){n=6,o=60,i=100,a=1e5;r.uploadFiles=function(e){for(var t=this,r=0;r<e.length;r++)for(var s=e[r],l=Math.round(Math.min(o,Math.max(n,s.size/a))),u=0;u<l;u++){var c=i*(u+1);setTimeout(function(e,n,o){return function(){e.upload={progress:100*(o+1)/n,total:e.size,bytesSent:(o+1)*e.size/n},t.emit("uploadprogress",e,e.upload.progress,e.upload.bytesSent),100==e.upload.progress&&(e.status=Dropzone.SUCCESS,t.emit("success",e,"success",null),t.emit("complete",e),t.processQueue())}}(s,l,u),c)}}}else r.on("sending",(function(e,t,n){t.setRequestHeader("OriginalFileName",fixFileName(e.name)),t.setRequestHeader("ContentType",e.type),t.setRequestHeader("ContentLength",e.size)})),r.on("error",(function(e){swal({title:"Error",text:"Upload failed",type:"error",showConfirmButton:!0}),console.error(e)})),r.on("success",(function(e){var t=JSON.parse(e.xhr.response);if(t&&t.Url){var n=JSON.parse(e.xhr.response).Url,o=Config.getFileNameUploaded(n),i=this.files.filter((function(e){return"error"!==e.status})),a=i.length-1,r=i.findIndex((function(t){return t==e}));fileUploaded({file:{url:n,name:o,contentLength:e.size||"",contentType:e.type||"",originalFileName:e.name||""},isLastDocument:r===a?1:0})}})),r.on("queuecomplete",(function(){var e=this,t=e.files,n=(e.options,[]);if("number"==typeof e.options.maxFiles&&e.files.length>e.options.maxFiles){swal({title:"Warning",text:"Maximum number of files is "+e.options.maxFiles+". All other files will be deleted",type:"success",showConfirmButton:!0});for(var o=e.files.length,i=e.options.maxFiles;i<o;i++)e.removeFile(t[i]);t.splice(e.files.length,o-e.options.maxFiles)}for(i=0;i<t.length;i++){var a=t[i];if("success"===a.status&&!a.added){var r=JSON.parse(a.xhr.response).Url,s=Config.getFileNameUploaded(r);n.push({url:r,name:s,contentLength:a.size||"",contentType:a.type||"",originalFileName:a.name||""}),a.added=!0}}}))}}));var Config={fakeUpload:!1,cmsRootPath:"",siteUrl:"https://sandbox.eccentex.com/",appBaseDomain:"DCM2.TENANT12",appBaseTokenSystemDomain:"config.tenant12",caseCreateRule:"root_MDM_CreateCaseWithDataFn",caseGetTypesRule:"root_STP_getCaseTypes",caseSearchRule:"root_DCM_SearchCases",ExtPartySearchRule:"ROOT_CUST_GETEXTPARTYDATA",getCookieTokenName:function(){return this.appBaseDomain+"_appbaseusertoken"},getCookieLoginName:function(){return this.appBaseDomain+"_appbaseuserlogin"},getCaseDetailPageParams:function(){return"app=CaseDetailRuntime&group=FOM&usePageConfig=1&appid=root_CaseManagement"},getCMSServiceRestUrl:function(e){return this.siteUrl+"CMS.WebService/CMSServiceRest.svc/"+e},getRuntimeDomain:function(){return this.appBaseDomain},getFileNameToUpload:function(e){if(e){var t=new Date,n=t.getFullYear()+""+t.getMonth()+t.getDate()+t.getHours()+t.getMinutes()+t.getSeconds()+t.getMilliseconds();return encodeURIComponent(e.replace(/(.*?)(\.[^.]*)?$/,"$1_"+n+"$2"))}},getFileNameUploaded:function(e){return e.substring(e.length-e.split("").reverse().join("").indexOf("/"),e.length)}};function setTokenExpires(){authControl("noauth"),swal({title:"Warning",text:"Set Token Expired. You are not authorized for this action",type:"warning"})}function logOutAction(){swal({title:"Confirmation",text:"Are you sure you want to log out?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},(function(e){e&&removeTokenFromCookie()}))}function onSearchCaseData(){var e=document.getElementById("txtCaseSearchCaseNumber"),t=document.getElementById("txtCaseSearchResult");if(e.value){var n=String.format("{0}BDS.WebService/DataServiceRest.svc/post/{1}/{2}",Config.siteUrl,Config.appBaseDomain,Config.caseSearchRule),o=getCookieByName(Config.getCookieTokenName());if(!o)return void setTokenExpires();n+="?t="+o,$.ajax({url:n,type:"POST",dataType:"text",data:{CaseId:e.value},success:function(e){e=getCorrectJSON(e);var n=JSON.parse(e);if(!n||500!==n.ErrorCode)if(n&&n.DATA){var o=n.DATA[Config.caseSearchRule],i=o?o.ITEMS:null;if(i&&i.length>0)if(1===i.length){var a=i[0].CASESTATE_NAME,r=i[0].CASEID;t.value=a||r?String.format("{0} status: {1}",r,a):"Data was not found"}else t.value="More than one case found. Please specify case number (full match)";else t.value="Data was not found"}else t.value="Data was not found"},error:function(e,t){swal({title:"Warning",text:"Error on Search Case Data. Please contact your administrator",type:"warning"})}})}else swal({title:"Warning",text:"Please specify case number",type:"warning"})}function onSignInAction(){var e=$("#txtSignInUserName").val(),t=$("#txtSignInPassword").val();if(!e||!t)return e="",void(t="");$("#txtUsername").val(e);var n=String.format("{0}Security.WebService/AuthenticationServiceRest.svc/login.post",Config.siteUrl);return $.ajax({url:n,type:"POST",data:{u:e,p:t},success:function(t){saveTokenIntoCookie(t),saveLoginIntoCookie(e),$("#username").text(e),$("#login-modal").modal("hide"),swal({title:"Success",text:"You have successfully logged in",timer:1e3,type:"success",showConfirmButton:!1},(function(){location.reload()}))},error:function(e,t){swal({title:"Warning",text:"Invalid User or Password",type:"warning"})}}),!1}function getFormattedDate(e){var t=e.getMonth()+1,n=e.getDate();return t<10&&(t="0"+t),n<10&&(n="0"+n),n+"/"+t+"/"+e.getFullYear()}function getCorrectJSON(e){return e=e.replace(/new Date\(-*[0-9]+\)/g,(function(e,t,n){return'"'+getFormattedDate(new Date(parseInt(e.replace(/^\D+/g,""))))+'"'}))}function authControl(e){var t=$("#btnLogin"),n=$("#btnLogOut"),o=$("#btnRefreshGrid");liLoginInfo=$("#login_info"),divMyAccount=$("#divMyAccount"),divPaymentReq=$("#divPaymentReq"),divGeneralInquiry=$("#divGeneralInquiry"),divHelpCenter=$("#divHelpCenter"),gridUserCases=$("#gridUserCases");var i=document.getElementById("txtExtPartyID");"auth"===e?(t.invisible(),n.visible(),liLoginInfo.visible(),o.visible(),divMyAccount.visible(),divPaymentReq.visible(),divGeneralInquiry.visible(),loadUserProfileData(),loadUserCases(i.value)):(t.visible(),n.invisible(),liLoginInfo.invisible(),o.invisible(),divMyAccount.detach(),divPaymentReq.detach(),divGeneralInquiry.detach(),gridUserCases.detach())}function saveLoginIntoCookie(e){var t=new Date,n=t.getTime()+36e5;t.setTime(n),document.cookie=Config.getCookieLoginName()+"="+e+"; expires="+t.toUTCString()+";"}function saveTokenIntoCookie(e){var t=new Date,n=t.getTime()+36e5;t.setTime(n),document.cookie=Config.getCookieTokenName()+"="+e+"; expires="+t.toUTCString()+";"}function removeTokenFromCookie(){document.cookie=Config.getCookieTokenName()+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie=Config.getCookieLoginName()+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",authControl("noauth")}function getCookieByName(e){if(document.cookie.length>0){var t=document.cookie.indexOf(e+"=");if(-1!=t){t=t+e.length+1;var n=document.cookie.indexOf(";",t);return-1==n&&(n=document.cookie.length),decodeURI(document.cookie.substring(t,n))}}return""}function loadUserCases(e){var t=String.format("{0}BDS.WebService/DataServiceRest.svc/post/{1}/{2}",Config.siteUrl,Config.appBaseDomain,Config.caseSearchRule),n=getCookieByName(Config.getCookieTokenName());n&&(t+="?t="+n,$("#gridUserCases").jsGrid({width:"90%",inserting:!1,editing:!1,sorting:!1,paging:!0,pageSize:5,autoload:!0,controller:{loadData:function(){var n=$.Deferred();return $.ajax({url:t,type:"POST",data:{ExternalPartyIds:e,sort:"ID",dir:"DESC"},dataType:"text",success:function(e){e=getCorrectJSON(e);var t=JSON.parse(e);if(t&&t.DATA){for(var o=t.DATA[Config.caseSearchRule],i=o?o.ITEMS:null,a=[],r=0,s=i.length;r<s;r++)a.push({"Case #":i[r].CASEID,Type:i[r].CASESYSTYPE_NAME,Summary:i[r].SUMMARY,Status:i[r].CASESTATE_NAME,"Created Date":i[r].CREATEDDATE,CASEID:i[r].ID});a&&a.length>0?n.resolve(a):n.resolve(null)}else t&&t.ErrorCode,n.resolve(null)},failure:function(e){alert(e)},error:function(e,t){swal({title:"Warning",text:"Error Loading User Cases. Please contact your administrator",type:"warning"})}}),n.promise()}},rowClick:function(e){var t=e.item,n=t["Case #"],o=t.CASEID;o&&swal({title:"Confirmation",text:"Do you want open "+n+" case?",type:"warning",showCancelButton:!0,confirmButtonText:"Yes",closeOnConfirm:!0},(function(e){if(e){var t=String.format("{0}Ecx.Web/en-US/do/root_UTIL_BasePage?Case_Id={1}&d={2}&{3}",Config.siteUrl,o,Config.appBaseDomain,Config.getCaseDetailPageParams()),n=getCookieByName(Config.getCookieTokenName());if(!n)return void setTokenExpires();t+="&t="+n,window.open(t)}}))},fields:[{name:"Case #",type:"text",width:200},{name:"Type",type:"text",width:200},{name:"Summary",type:"text",width:350},{name:"Created Date",type:"text",width:100},{name:"Status",type:"text",width:100}]}))}function refreshGrid(){var e=$("#txtExtPartyID").val();console.log("Updating Cases Grid for ID: "+e),loadUserCases(e)}function loadUserInformation(){var e=getCookieByName(Config.getCookieLoginName());if(e){var t=String.format("{0}Security.WebService/AdministrationServiceRest.svc/users/{1}/login/l?login={2}",Config.siteUrl,Config.appBaseTokenSystemDomain,e),n=getCookieByName(Config.getCookieTokenName());n&&(t+="&t="+n,$.ajax({url:t,dataType:"text",type:"GET",data:{},success:function(e){if(!e||500!==e.ErrorCode){var t=document.getElementById("txtAccountFullName"),n=(e=getCorrectJSON(e),JSON.parse(e));if(n&&n.User&&n.User.length>0){var o=n.User[0];o&&(t.value=o.Name,o.UserId&&loadUserProfileData(o.UserId))}}},error:function(e,t){swal({title:"Warning",text:"loadUserInformation Error. Please contact your administrator",type:"warning"})}}))}}function loadUserProfileData(){var e=String.format("{0}BDS.WebService/DataServiceRest.svc/post/{1}/ROOT_CUST_PRTL_GETUSERINFO",Config.siteUrl,Config.appBaseDomain),t=getCookieByName(Config.getCookieLoginName()),n=getCookieByName(Config.getCookieTokenName());$("#txtUsername").val(t),$("#username").text(t),console.log("vLogin : "+t);var o=document.getElementById("txtExtPartyID"),i=document.getElementById("txtAccountFullName"),a=document.getElementById("txtAccountEmail"),r=document.getElementById("txtAccountPhone");n&&(e+="?t="+n,$.ajax({dataType:"text",url:e,type:"POST",data:{login:t},success:function(e){e=getCorrectJSON(e);var t=JSON.parse(e);if(!t||500!==t.ErrorCode){var n=t.DATA.ROOT_CUST_PRTL_GETUSERINFO,s="";n&&(s=n.ITEMS[0],o.value=s.EP_ID,i.value=s.USR_NAME,a.value=s.USR_EMAIL,r.value=s.USR_PHONE,$("#txtPesel").val(s.PPL_PESEL),$("#lastLogin").text(s.USR_LASTLOGINDATE),console.log("Pesel= "+s.PPL_PESEL),console.log("EP= "+s.EP_ID),console.log("lastLogin= "+s.USR_LASTLOGINDATE))}},error:function(e,t){swal({title:"Warning",text:"Loading User Profile Error. Please contact your Administrator",type:"warning"})}}))}$("[data-toggle=tooltip]").tooltip(),String.format=function(){for(var e=arguments[0],t=0;t<arguments.length-1;t+=1){var n=new RegExp("\\{"+t+"\\}","gm");e=e.replace(n,arguments[t+1])}return e},$(document).ready((function(){authControl(getCookieByName(Config.getCookieTokenName())?"auth":"noauth")})),function(e){e.fn.invisible=function(){return this.each((function(){e(this).css("visibility","hidden")}))},e.fn.visible=function(){return this.each((function(){e(this).css("visibility","visible")}))}}(jQuery),$(document).ready((function(){$(".search").keyup((function(){var e=$(".search").val(),t=($(".results tbody").children("tr"),e.replace(/ /g,"'):containsi('"));$.extend($.expr[":"],{containsi:function(e,t,n,o){return(e.textContent||e.innerText||"").toLowerCase().indexOf((n[3]||"").toLowerCase())>=0}}),$(".results tbody tr").not(":containsi('"+t+"')").each((function(e){$(this).attr("visible","false")})),$(".results tbody tr:containsi('"+t+"')").each((function(e){$(this).attr("visible","true")}));var n=$('.results tbody tr[visible="true"]').length;$(".counter").text(n+" item"),"0"==n?$(".no-result").show():$(".no-result").hide()}))})),function(e){"use strict";e("#sidebarToggle, #sidebarToggleTop").on("click",(function(t){e("body").toggleClass("sidebar-toggled"),e(".sidebar").toggleClass("toggled"),e(".sidebar").hasClass("toggled")&&e(".sidebar .collapse").collapse("hide")})),e(window).resize((function(){e(window).width()<768&&e(".sidebar .collapse").collapse("hide")})),e("body.fixed-nav .sidebar").on("mousewheel DOMMouseScroll wheel",(function(t){if(e(window).width()>768){var n=t.originalEvent,o=n.wheelDelta||-n.detail;this.scrollTop+=30*(o<0?1:-1),t.preventDefault()}})),e(document).on("scroll",(function(){e(this).scrollTop()>100?e(".scroll-to-top").fadeIn():e(".scroll-to-top").fadeOut()})),e(document).on("click","a.scroll-to-top",(function(t){var n=e(this);e("html, body").stop().animate({scrollTop:e(n.attr("href")).offset().top},1e3,"easeInOutExpo"),t.preventDefault()}))}(jQuery);